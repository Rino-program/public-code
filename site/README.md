# Study Support（ローカル保存・Webのみ）一枚まとめ

宿題や課題など「やらなければいけないこと」を、なるべく迷わず・すぐに・淡々と進めるためのシンプルな学習補助サイト。  
核は正確なポモドーロタイマー＋タスク紐づけ＋自動ログ。データはすべてブラウザ内に保存され、いつでもエクスポート/インポートできます。

---

## このドキュメントの目的
- プロダクトの方向性とMVP仕様を1ファイルで共有
- 開発・デザイン・運用の共通前提を明確化
- すぐ作り始めるための実装指針とロードマップを提示

---

## 想定ユーザーと価値
- 対象
  - 宿題・レポート・課題など「やらねばならないタスク」をこなす人（学生、受験生、社会人の自己研鑽）
- 解決したいこと
  - 取りかかりの遅れ（開始ハードル）
  - 集中の断絶（スマホ・他サイトの誘惑）
  - 記録の手間（作業時間の集計）
- 提供価値
  - 1クリックで集中開始できる賢いタイマー
  - タスクに紐づく自動ログで、今日・今週の進捗がひと目でわかる
  - 完全ローカル保存でプライバシー重視、いつでもデータ持ち出し可

---

## 固定の前提（プラットフォーム・データ・将来機能）
- プラットフォーム
  - Webのみ（まずはPWA化でオフライン動作）
- データ保存
  - 基本はローカルストレージ（localStorage）に保存
  - JSONエクスポート/インポートを標準提供
- 共同自習室
  - 後フェーズ（サーバ導入時に検討）

---

## 3つの任せポイント（決定事項）
- 1) 週合計の表示
  - 採用：MVPから「今日」と「今週（直近7日）」の両方を表示
  - 理由：学習は日単位のムラが出やすく、週視点が継続判断に有効
- 2) 通知（Web通知）
  - 段階導入：MVPでは非必須。v0.2で導入（初回は控えめに許可を案内、休憩開始/終了のみ）
  - 理由：開始直後の通知許可は離脱要因。使い始めを最優先
- 3) タスクの分類（科目/タグ）
  - 採用：MVPから「任意の科目/タグ」を1フィールドで付与可能
  - 理由：最低限の分類でも内訳が役立つ。UI負担を増やさず効果が高い

---

## MVP機能（v0.1）
- ポモドーロタイマー
  - フォーカス/短休憩/長休憩の自動切替、ラウンド管理
  - タブタイトルに残り時間を表示
  - 正確な計時（Date.nowベース、タブ非アクティブでもドリフト最小）
  - 操作：開始/一時停止/再開/スキップ/リセット
- タスク管理（最小）
  - タスクの追加/選択/削除
  - 任意の「科目/タグ」フィールド
- 自動ログ
  - フォーカス開始〜終了を自動記録（タスク紐づけ、ラウンド番号、所要時間）
- 統計
  - 今日の合計・タスク別内訳
  - 今週（直近7日）の合計・タスク別内訳（簡易表示）
- データ操作
  - JSONエクスポート/インポート
- PWA（最小）
  - オフライン動作（静的キャッシュ＋フォールバック）

---

## 次フェーズ機能
- v0.2
  - Web通知（休憩開始/終了、許可は必要時に軽く案内）
  - 集中モード（UI最小化、フルスクリーン、環境音は任意）
  - キーボードショートカット（Space=開始/一時停止、S=スキップ など）
- v0.3
  - SRS（最小）：フラッシュカード＋SM-2（ローカル保存）、CSV/Ankiインポート
  - 週目標時間と達成度表示、ストリーク
- v0.4
  - 共同自習室のプレゼンスだけ（後フェーズ・サーバ導入時）

---

## 体験フロー（MVP）
1. ランディング → 「今すぐ始める」（アカウント不要）
2. タスクを選択（未選択でも開始可能）
3. タイマー開始（フォーカス）→ 自動記録
4. 休憩に切り替わる → 次のフォーカスへ
5. ダッシュボードで今日/今週の進捗を確認
6. 必要なら「エクスポート」でバックアップ

---

## UI/画面構成（MVP）
- セッション（メイン）
  - タスク選択ドロップダウン＋新規追加
  - タイマー表示と操作ボタン
  - 現在のラウンド、モード（集中/短休憩/長休憩）
- ダッシュボード（軽量セクションでOK）
  - 今日：合計時間、セッション数、タスク別内訳
  - 今週：合計時間、タスク別内訳（簡易集計）
- 設定
  - タイマー設定（集中/休憩分数、長休憩までのラウンド数）
  - データのエクスポート/インポート
  - テーマ（任意：ライト/ダーク/システム）

---

## 仕様詳細（MVP）
- タイマー
  - 既定値：集中25分 / 短休憩5分 / 長休憩15分 / 4ラウンドで長休憩
  - ロジック：Date.now基準で経過を算出、250ms刻みでtick（視覚更新）
  - タブタイトルに「絵文字＋残り時間」を表示（例：🎯 24:59）
- タスク
  - 最小項目：タイトル、科目/タグ（任意）、メモ（任意）
  - 現在の作業タスクを選択（未選択でもログは「未選択」として記録）
- 自動ログ
  - フォーカス開始で開始時刻を保持、フォーカス終了（休憩遷移/スキップ）時にセッション保存
  - 保存項目：taskId、startedAt、endedAt、durationMs、round
- 統計
  - 今日：0時〜24時で集計
  - 今週：当日を含む直近7日間で集計（サマリ重視の簡易表示）
  - 単位：分（四捨五入）、内訳はタスク名で表示

---

## データモデル（最小）
- User（なし：完全ローカル運用）
- Task
  - id, title, subject, notes, createdAt, updatedAt, archived?
- StudySession
  - id, taskId?, startedAt, endedAt, durationMs, round
- Settings
  - focusMinutes, shortBreakMinutes, longBreakMinutes, roundsUntilLongBreak, currentTaskId?, theme?

保存先：localStorage key = `studyapp.db.v1`  
形式：バージョン付きJSONスナップショット（破損時は自動バックアップして初期化）

---

## 非機能・技術指針
- パフォーマンス
  - 記録・集計は軽量。大規模化や検索が必要になったらIndexedDBへ移行検討
- オフライン
  - PWAのService Workerで静的資産をキャッシュ。オンライン不要でタイマー動作
- アクセシビリティ
  - キーボード操作、十分なコントラスト、ARIAラベル（ボタン・セレクト）
- プライバシー
  - 通信しない（アナリティクスもオフ、オプトイン設計を検討）
  - データは常にユーザーの手元で完結。削除はブラウザの削除でOK
- 技術スタック（例）
  - フロント：TypeScript + Next.js or Vite + React、Tailwind（任意）
  - 状態/データ：localStorage（後にIndexedDBへ拡張可）
  - 配信：Vercel/Netlify（静的で十分）
  - 監視：Sentryは後フェーズ（通信前提のため）

---

## ロードマップ
- v0.1（MVP：2〜3週間）
  - タイマー自動切替、タスク選択、フォーカス自動ログ
  - 今日/今週の集計、エクスポート/インポート、PWA最小
- v0.2（+2週間）
  - Web通知（休憩開始/終了）、集中モード、ショートカット
- v0.3（+1〜2ヶ月）
  - SRS最小（フラッシュカード＋SM-2、ローカル保存）
  - 週目標、ストリーク、簡易バッジ
- v0.4（後フェーズ）
  - 共同自習室（プレゼンス）、必要に応じてサーバ導入

---

## 開発メモ（実装のコツ）
- タイマー
  - setIntervalはUI更新だけに使い、残り時間はDate.nowから逆算（タブ切替でも正確）
  - 切替時の境界（0以下になった瞬間）の処理は一度だけ実行する
- ローカルDB
  - 変更単位でスナップショット保存（updatedAtを更新）
  - 複数タブ同期はstorageイベントで反映
  - 破損検知：JSON.parse失敗時、バックアップkey（.corrupt.timestamp）へ避難
- 週次集計
  - 直近7日を日次で集約 → 合計/タスク別合算を表示（グラフは後で）
- エクスポート/インポート
  - ファイル名にISOタイムスタンプを付与
  - バージョンチェック（version !== 1 は弾く）

---

## 既知のリスクと対策
- 通知許可の離脱
  - v0.2で導入し、最初の休憩開始時に控えめな案内にする
- ローカル容量上限
  - テキスト中心なら問題なし。ログが肥大化したらIndexedDB移行、古いログの圧縮/集約
- データ消失
  - 定期的にエクスポートを促すトースト/バナーを検討
- 過度な機能追加での複雑化
  - 「1クリックで始められる」導線の純度を守る。設定は後置き

---

## 将来アイデア
- SRS（フラッシュカード＋SM-2、画像/数式、Anki/CSVインポート）
- カレンダー連携（時間ブロック、ログを書き戻し）
- Chrome拡張（サイトブロック、拡張アイコンで残り時間表示）
- AI補助（ノートから穴埋めクイズ生成、学習ログから最適時間帯の提案）※完全オプトイン

---

## 使い方（ユーザー向け超簡単版）
1. タスクを追加して選ぶ（または未選択で始める）
2. 「開始」を押す
3. 集中が終わるたびにログが自動で記録される
4. 今日/今週の合計で進捗を確認
5. データはいつでも「エクスポート」で保存

---

## 次のアクション
- UIの初版を作成（セッション画面＋今日/今週の簡易統計＋設定）
- 使いながら細部（表示文言、ボタン配置、色）を微調整
- v0.2の通知・集中モードに向けて設計を薄く準備（後方互換の設定キーにしておく）

以上。ここから実装に取りかかれます。文言や優先順位の微修正はいつでも相談してください。やさしく、続けやすい体験を一緒に仕上げていきましょう。